# *********************************************************** S3 Bucket ***********************************************************
Resources:
  Bucket:
    Type: AWS::S3::Bucket
    # DependsOn: BucketInvokePermission
    Properties:
      BucketName: !Sub ${self:service}-${self:provider.stage}
  #     NotificationConfiguration:
  #       LambdaConfigurations:
  #         - Event: s3:ObjectCreated:*
  #           Filter:
  #             S3Key:
  #               Rules:
  #                 - Name: 'prefix'
  #                   Value: 'receipts/'
  #                 - Name: 'suffix'
  #                   Value: '.csv'
  #           Function: !Sub arn:aws:lambda:${self:provider.region}:${AWS::AccountId}:function:${self:service}-${self:provider.stage}-example
  #         - Event: s3:ObjectCreated:*
  #           Filter:
  #             S3Key:
  #               Rules:
  #                 - Name: 'prefix'
  #                   Value: 'vendors/'
  #                 - Name: 'suffix'
  #                   Value: '.csv'
  #           Function: !Sub arn:aws:lambda:${self:provider.region}:${AWS::AccountId}:function:${self:service}-${self:provider.stage}-example
  # BucketInvokePermission:
  #   Type: AWS::Lambda::Permission
  #   Properties:
  #     FunctionName: !Sub arn:aws:lambda:${self:provider.region}:${AWS::AccountId}:function:${self:service}-${self:provider.stage}-example
  #     Action: lambda:InvokeFunction
  #     Principal: s3.amazonaws.com
  #     SourceArn: !Sub arn:aws:s3:::${self:service}-${self:provider.stage}

# *********************************************************** DynamoDB ***********************************************************
  FoodOptionsTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ${self:service}-${self:provider.stage}-food-options
      AttributeDefinitions:
        - AttributeName: name
          AttributeType: S
        - AttributeName: food_type
          AttributeType: S
        - AttributeName: visited
          AttributeType: B        
      KeySchema:
        - AttributeName: name
          KeyType: HASH
      GlobalSecondaryIndexes:
        - IndexName: food_type-index
          KeySchema:
            - AttributeName: food_type
              KeyType: HASH
          Projection:
            ProjectionType: ALL
        - IndexName: visited-index
          KeySchema:
            - AttributeName: visited
              KeyType: HASH
          Projection:
            ProjectionType: ALL
      BillingMode: PAY_PER_REQUEST
      SSESpecification:
        SSEEnabled: true